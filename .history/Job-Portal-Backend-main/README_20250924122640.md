# Gestor de Proyectos Turrisystem

Sistema de gestión de proyectos integrado con OpenProject que incluye gestión de usuarios con avatares personalizados.

## Arquitectura

El sistema utiliza una arquitectura de microservicios con Docker:

- **Backend (Node.js/Express)**: API REST con integración OpenProject
- **Base de datos (PostgreSQL)**: Almacenamiento de usuarios y datos
- **Nginx**: Servidor de imágenes estáticas para avatares
- **Frontend (React)**: Interfaz de usuario moderna

## Requisitos

- Docker y Docker Compose
- Node.js 18+ (para desarrollo local)
- PostgreSQL (opcional, incluido en Docker)

## Instalación y Ejecución

### Con Docker (Recomendado)

1. **Clona el repositorio:**
   ```bash
   git clone <repository-url>
   cd Job-Portal-Backend-main
   ```

2. **Inicia los servicios:**
   ```bash
   docker-compose up --build
   ```

3. **Accede a la aplicación:**
   - Frontend: http://localhost:3001
   - Backend API: http://localhost:3000
   - Imágenes: http://localhost:8081

4. **Contenedores activos:**
   - `gestor_proyectos_turri` - API Backend
   - `gestor_proyectos_turri_db` - PostgreSQL
   - `gestor_proyectos_turri_images` - Nginx para imágenes

### Desarrollo Local

1. **Instala dependencias:**
   ```bash
   npm install
   cd ../Job-Portal-Frontend-main
   npm install
   ```

2. **Configura PostgreSQL:**
   ```sql
   CREATE DATABASE gestor_proyectos_turri;
   CREATE USER postgres WITH PASSWORD 'julio.turri';
   GRANT ALL PRIVILEGES ON DATABASE gestor_proyectos_turri TO postgres;
   ```

3. **Ejecuta el backend:**
   ```bash
   npm run dev
   ```

4. **Ejecuta el frontend:**
   ```bash
   cd ../Job-Portal-Frontend-main
   npm start
   ```

## Configuración

### Variables de Entorno

Crea un archivo `.env` en el directorio backend:

```env
# Base de datos
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASS=julio.turri
DB_NAME=gestor_proyectos_turri

# OpenProject
OPENPROJECT_URL=http://181.49.45.246:9000
OPENPROJECT_API_TOKEN=tu_token_aqui

# Aplicación
PORT=3000
SESSION_SECRET=tu_clave_secreta_muy_segura

# Node
NODE_ENV=development
```

## API Endpoints

### Autenticación
- `POST /api/auth/login` - Login con OpenProject

### Proyectos
- `GET /api/projects/projects/:id` - Detalles del proyecto
- `GET /api/projects/projects/:id/members` - Miembros del proyecto
- `GET /api/projects/projects/:id/work-packages` - Tareas del proyecto

### Usuarios
- `GET /api/users/profile` - Perfil del usuario actual
- `POST /api/users/avatar` - Subir avatar
- `PUT /api/users/profile` - Actualizar perfil

## Gestión de Avatares

### Subida de Imágenes
- **Límite**: 5MB por archivo
- **Formatos**: JPEG, PNG, GIF, WebP
- **Almacenamiento**: `uploads/avatars/`
- **URL pública**: `http://localhost:8081/avatars/filename.ext`

### Ejemplo de subida:
```javascript
const formData = new FormData();
formData.append('avatar', file);

fetch('/api/users/avatar', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`
  },
  body: formData
});
```

## Base de Datos

### Tabla de Usuarios
```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  openproject_id INTEGER UNIQUE,
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(255),
  avatar_url TEXT,
  role VARCHAR(100),
  last_sync TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## Desarrollo

### Scripts Disponibles
- `npm start` - Producción
- `npm run dev` - Desarrollo con nodemon
- `docker-compose up --build` - Construir y ejecutar con Docker

### Estructura del Proyecto
```
Job-Portal-Backend-main/
├── src/
│   ├── controllers/
│   │   ├── authController.js
│   │   ├── openProjectController.js
│   │   └── userController.js
│   ├── middleware/
│   │   └── authMiddleware.js
│   ├── routes/
│   │   ├── auth.routes.js
│   │   ├── openproject.routes.js
│   │   └── user.routes.js
│   ├── services/
│   │   └── openProjectService.js
│   ├── config/
│   │   └── db.js
│   └── app.js
├── uploads/
│   └── avatars/
├── docker-compose.yml
├── Dockerfile
├── nginx.conf
├── init.sql
└── package.json
```

## Características

- ✅ **Integración OpenProject**: Autenticación y sincronización
- ✅ **Gestión de usuarios**: Perfiles con avatares personalizados
- ✅ **Arquitectura Docker**: Fácil despliegue y escalabilidad
- ✅ **Cache de imágenes**: Nginx con expiración de 30 días
- ✅ **Seguridad**: JWT, validación de archivos, CORS
- ✅ **Responsive**: Interfaz adaptativa para móviles

## Solución de Problemas

### Error de conexión a PostgreSQL
```bash
# Verificar contenedores
docker-compose ps

# Ver logs
docker-compose logs db

# Reiniciar servicios
docker-compose down && docker-compose up --build
```

### Problemas con avatares
- Verificar permisos del directorio `uploads/`
- Comprobar configuración de Nginx
- Revisar límites de tamaño de archivo

### Error 401 en OpenProject
- Verificar token de API
- Comprobar URL de OpenProject
- Revisar permisos del usuario en OpenProject

## Contribución

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit tus cambios (`git commit -am 'Agrega nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Abre un Pull Request

## Licencia

Este proyecto está bajo la Licencia ISC.